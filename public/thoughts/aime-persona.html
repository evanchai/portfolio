<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="ä¸é å¾®è°ƒï¼Œåªé ç»Ÿè®¡åˆ†æ + Prompt å·¥ç¨‹ï¼šå¦‚ä½•è®© AI å­¦ä¼šä¸€ä¸ªçœŸäººçš„èŠå¤©é£æ ¼ã€‚" />
  <title>è®© AI å­¦ä¼šçœŸäººèŠå¤©ï¼šä»å¾®ä¿¡è®°å½•åˆ° Persona Chatbot â€” Ning</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,200;0,9..144,300;0,9..144,400;0,9..144,600;1,9..144,200;1,9..144,300;1,9..144,400&family=Noto+Sans+SC:wght@200;300;400;500&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg: #f0ebe4;
      --bg2: #e7e0d6;
      --card: #f6f2ec;
      --text: #2e2b26;
      --text-2: #6d665c;
      --text-3: #a69e94;
      --olive: #5e7050;
      --olive-light: #7a9469;
      --olive-bg: rgba(94,112,80,0.07);
      --line: #d4ccc2;
      --serif: 'Fraunces', 'Noto Sans SC', 'PingFang SC', 'Microsoft YaHei', sans-serif;
      --mono: 'Space Mono', monospace;
      --sans: 'Noto Sans SC', 'PingFang SC', -apple-system, sans-serif;
    }

    html { height: 100%; scroll-behavior: smooth; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--sans);
      font-weight: 400;
      font-size: 15px;
      line-height: 1.9;
      -webkit-font-smoothing: antialiased;
      min-height: 100%;
    }

    ::selection { background: var(--olive); color: #fff; }

    .page { max-width: 720px; margin: 0 auto; padding: 0 2rem; }

    /* â”€â”€ Back link â”€â”€ */
    .back-link {
      display: flex;
      justify-content: flex-end;
      padding: 2rem 0 0;
    }

    .back-link a {
      font-family: var(--mono);
      font-size: 0.7rem;
      color: var(--text-3);
      text-decoration: none;
      letter-spacing: 0.05em;
      transition: color 0.3s ease;
    }

    .back-link a:hover { color: var(--olive); }

    /* â”€â”€ Article Header â”€â”€ */
    .article-header {
      padding: 3rem 0 2rem;
      border-bottom: 1px solid var(--line);
      margin-bottom: 3rem;
    }

    .article-meta {
      font-family: var(--mono);
      font-size: 0.62rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-3);
      margin-bottom: 1.5rem;
      display: flex;
      gap: 1.5rem;
      flex-wrap: wrap;
    }

    .article-header h1 {
      font-family: var(--serif);
      font-weight: 200;
      font-size: clamp(2rem, 5vw, 3rem);
      line-height: 1.2;
      letter-spacing: -0.02em;
      margin-bottom: 1.2rem;
    }

    .article-header h1 em {
      font-style: italic;
      font-weight: 300;
      color: var(--olive);
    }

    .article-lead {
      font-family: var(--serif);
      font-size: 1.15rem;
      font-weight: 300;
      line-height: 1.8;
      color: var(--text-2);
      max-width: 56ch;
    }

    .article-tags {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-top: 0.5rem;
    }

    .article-tag {
      font-family: var(--mono);
      font-size: 0.6rem;
      color: var(--olive);
      letter-spacing: 0.04em;
    }

    /* â”€â”€ TOC â”€â”€ */
    .toc {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 1.8rem 2rem;
      margin-bottom: 3rem;
    }

    .toc-title {
      font-family: var(--mono);
      font-size: 0.62rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-3);
      margin-bottom: 1rem;
    }

    .toc ol { list-style: none; counter-reset: toc; }

    .toc li { counter-increment: toc; padding: 0.2rem 0; }

    .toc li::before {
      content: counter(toc, decimal-leading-zero);
      font-family: var(--mono);
      font-size: 0.65rem;
      color: var(--text-3);
      margin-right: 0.8rem;
    }

    .toc a {
      font-family: var(--serif);
      font-size: 0.95rem;
      font-weight: 300;
      color: var(--text);
      text-decoration: none;
      transition: color 0.3s;
    }

    .toc a:hover { color: var(--olive); }

    /* â”€â”€ Article Body â”€â”€ */
    .article-body h2 {
      font-family: var(--serif);
      font-weight: 300;
      font-size: 1.7rem;
      line-height: 1.3;
      margin: 3.5rem 0 1rem;
      padding-top: 1rem;
    }

    .article-body h2 em { font-style: italic; color: var(--olive); }

    .article-body h3 {
      font-family: var(--serif);
      font-weight: 400;
      font-size: 1.15rem;
      margin: 2.5rem 0 0.8rem;
      color: var(--text);
    }

    .article-body p { margin-bottom: 1.2rem; color: var(--text-2); }
    .article-body strong { color: var(--text); font-weight: 500; }

    .article-body a {
      color: var(--olive);
      text-decoration: underline;
      text-decoration-color: var(--line);
      text-underline-offset: 3px;
      transition: text-decoration-color 0.3s;
    }

    .article-body a:hover { text-decoration-color: var(--olive); }

    .article-body code {
      font-family: var(--mono);
      font-size: 0.82em;
      background: var(--bg2);
      border-radius: 4px;
      padding: 0.15em 0.45em;
    }

    .article-body ol, .article-body ul {
      margin: 0.8rem 0 1.5rem 1.5rem;
      color: var(--text-2);
    }

    .article-body li { margin-bottom: 0.4rem; padding-left: 0.3rem; }

    /* â”€â”€ Code blocks â”€â”€ */
    .code-block {
      background: #2e2b26;
      color: #e8e0d6;
      border-radius: 12px;
      padding: 1.4rem 1.6rem;
      font-family: var(--mono);
      font-size: 0.72rem;
      line-height: 1.9;
      overflow-x: auto;
      margin: 1.5rem 0 2rem;
      -webkit-overflow-scrolling: touch;
    }

    .code-block .cm { color: #7a7568; }
    .code-block .kw { color: #a3c486; }
    .code-block .str { color: #d4a96a; }
    .code-block .fn { color: #88b4d4; }
    .code-block .tp { color: #c4a3ff; }
    .code-block .num { color: #ffa3b3; }

    /* â”€â”€ Callout â”€â”€ */
    .callout {
      background: var(--card);
      border: 1px solid var(--line);
      border-left: 3px solid var(--olive);
      border-radius: 0 12px 12px 0;
      padding: 1.2rem 1.4rem;
      margin: 1.5rem 0 2rem;
      font-size: 0.88rem;
      color: var(--text-2);
      line-height: 1.8;
    }

    .callout b { color: var(--olive); }

    /* â”€â”€ Diagram â”€â”€ */
    .diagram {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 1.8rem;
      margin: 1.5rem 0 2rem;
      font-family: var(--mono);
      font-size: 0.72rem;
      line-height: 1.8;
      overflow-x: auto;
      white-space: pre;
      color: var(--text-2);
      -webkit-overflow-scrolling: touch;
    }

    .diagram .hl { color: var(--olive); font-weight: 700; }
    .diagram .dim { color: var(--text-3); }

    /* â”€â”€ Table â”€â”€ */
    .article-table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.5rem 0 2rem;
      font-size: 0.82rem;
    }

    .article-table th {
      font-family: var(--serif);
      font-weight: 400;
      font-size: 0.9rem;
      text-align: left;
      padding: 1rem;
      border-bottom: 2px solid var(--line);
      color: var(--text);
    }

    .article-table td {
      padding: 0.7rem 1rem;
      border-bottom: 1px solid var(--line);
      color: var(--text-2);
      line-height: 1.7;
      vertical-align: top;
    }

    .article-table tr:hover td { background: var(--olive-bg); }

    /* â”€â”€ Insight cards â”€â”€ */
    .insight-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin: 1.5rem 0 2rem;
    }

    .insight-card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 1.4rem 1.5rem;
      transition: all 0.35s ease;
    }

    .insight-card:hover {
      transform: translateY(-3px);
      border-color: var(--olive-light);
      box-shadow: 0 12px 36px rgba(46,43,38,0.05);
    }

    .insight-card h4 {
      font-family: var(--serif);
      font-weight: 400;
      font-size: 0.95rem;
      margin-bottom: 0.5rem;
    }

    .insight-card p {
      font-size: 0.78rem;
      color: var(--text-2);
      line-height: 1.8;
      margin: 0;
    }

    /* â”€â”€ Stats row â”€â”€ */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
      margin: 1.5rem 0 2rem;
    }

    .stat-card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 1.2rem;
      text-align: center;
      transition: all 0.3s;
    }

    .stat-card:hover {
      border-color: var(--olive-light);
      transform: translateY(-2px);
    }

    .stat-val {
      font-family: var(--serif);
      font-size: 1.8rem;
      font-weight: 300;
      color: var(--olive);
      line-height: 1.2;
    }

    .stat-label {
      font-size: 0.62rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--text-3);
      margin-top: 0.4rem;
    }

    /* â”€â”€ Section divider â”€â”€ */
    .section-divider { border: none; border-top: 1px solid var(--line); margin: 3rem 0; }

    /* â”€â”€ Footer â”€â”€ */
    .page-footer {
      border-top: 1px solid var(--line);
      padding: 1.5rem 0 3rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-family: var(--mono);
      font-size: 0.62rem;
      color: var(--text-3);
      letter-spacing: 0.04em;
      margin-top: 4rem;
    }

    .page-footer .made { display: flex; align-items: center; gap: 0.5rem; }
    .page-footer .heart { display: inline-block; width: 5px; height: 5px; border-radius: 50%; background: var(--olive); }

    /* â”€â”€ Language Toggle â”€â”€ */
    .lang-toggle { position: fixed; top: 2rem; right: 2rem; font-family: var(--mono); font-size: 0.65rem; letter-spacing: 0.08em; padding: 0.4rem 1rem; border: 1px solid var(--line); border-radius: 100px; background: var(--card); color: var(--text-2); cursor: pointer; transition: all 0.3s; z-index: 50; }
    .lang-toggle:hover { border-color: var(--olive); color: var(--olive); }
    .en { display: none; }
    html.lang-en .zh { display: none; }
    html.lang-en .en { display: revert; }

    /* â”€â”€ Scroll reveal â”€â”€ */
    .rv { opacity: 0; transform: translateY(18px); transition: opacity 0.7s ease, transform 0.7s ease; }
    .rv.v { opacity: 1; transform: translateY(0); }

    /* â”€â”€ Responsive â”€â”€ */
    @media (max-width: 600px) {
      .page { padding: 0 1.2rem; }
      .article-header { padding: 2rem 0 1.5rem; margin-bottom: 2rem; }
      .article-header h1 { font-size: clamp(1.6rem, 7vw, 2.2rem); }
      .article-lead { font-size: 1rem; }
      .article-body h2 { font-size: 1.4rem; margin-top: 2.5rem; }
      .insight-grid { grid-template-columns: 1fr; }
      .stats-row { grid-template-columns: 1fr 1fr; }
      .article-table { font-size: 0.72rem; }
      .article-table th, .article-table td { padding: 0.5rem 0.6rem; }
      .page-footer { flex-direction: column; gap: 0.5rem; }
      .toc { padding: 1.4rem 1.5rem; }
      .lang-toggle { top: 1rem; right: 1rem; }
    }
  </style>
</head>
<body>

<div class="page">
  <div class="back-link">
    <a href="/thoughts">&larr; thoughts</a>
  </div>
  <button class="lang-toggle" id="langToggle">EN</button>

  <!-- Header -->
  <header class="article-header rv">
    <div class="article-meta">
      <span>Feb 2025</span>
      <span>Ning</span>
      <span class="zh">~12 min read</span>
      <span class="en">~12 min read</span>
    </div>
    <h1 class="zh">è®© AI å­¦ä¼šçœŸäººèŠå¤©ï¼š<br>ä»å¾®ä¿¡è®°å½•åˆ° <em>Persona</em> Chatbot</h1>
    <h1 class="en">Teaching AI to Chat Like a Real Person:<br>From WeChat History to <em>Persona</em> Chatbot</h1>
    <p class="article-lead zh">
      ä¸é å¾®è°ƒï¼Œä¸é  fine-tuningï¼Œåªé ç»Ÿè®¡åˆ†æ 8000+ æ¡çœŸå®èŠå¤©è®°å½•ï¼Œ
      æŠŠä¸€ä¸ªäººçš„è¯´è¯ä¹ æƒ¯é‡åŒ–æˆæ•°å­—ï¼Œç„¶åç¼–ç è¿› system promptã€‚
      ç»“æœæ˜¯ä¸€ä¸ªè¿æœ‹å‹éƒ½åˆ†ä¸æ¸…çœŸå‡çš„èŠå¤©æœºå™¨äººã€‚
    </p>
    <p class="article-lead en">
      No fine-tuning, no training data â€” just statistical analysis of 8000+ real chat messages,
      quantifying a person's speaking habits into numbers, then encoding them into a system prompt.
      The result: a chatbot that even friends can't tell apart from the real person.
    </p>
    <div class="article-tags">
      <span class="article-tag">#ai</span>
      <span class="article-tag">#chatbot</span>
      <span class="article-tag">#prompt-engineering</span>
      <span class="article-tag">#vibe-coding</span>
    </div>
  </header>

  <!-- TOC -->
  <nav class="toc rv">
    <div class="toc-title">Table of Contents</div>
    <ol class="zh">
      <li><a href="#idea">æ ¸å¿ƒç†å¿µï¼šæ•°æ®é©±åŠ¨çš„ Persona</a></li>
      <li><a href="#pipeline">è®­ç»ƒ Pipelineï¼šä»å¾®ä¿¡åˆ° Prompt</a></li>
      <li><a href="#style">ç»Ÿè®¡åˆ†æï¼šé‡åŒ–ä¸€ä¸ªäººçš„èŠå¤©é£æ ¼</a></li>
      <li><a href="#prompt">System Prompt çš„ç»“æ„</a></li>
      <li><a href="#runtime">è¿è¡Œæ—¶æ¶æ„</a></li>
      <li><a href="#multi-bubble">å¤šæ¶ˆæ¯å›å¤ï¼šæ¨¡æ‹ŸçœŸå®èŠå¤©èŠ‚å¥</a></li>
      <li><a href="#rag">RAG åˆ†æï¼šå€¼ä¸å€¼å¾—ç”¨ï¼Ÿ</a></li>
      <li><a href="#review">Review ç³»ç»Ÿï¼šé—­ç¯åé¦ˆ</a></li>
      <li><a href="#boundaries">å®‰å…¨è¾¹ç•Œ</a></li>
      <li><a href="#conclusion">æ€»ç»“</a></li>
    </ol>
    <ol class="en">
      <li><a href="#idea">Core Philosophy: Data-Driven Persona</a></li>
      <li><a href="#pipeline">Training Pipeline: From WeChat to Prompt</a></li>
      <li><a href="#style">Statistical Analysis: Quantifying Chat Style</a></li>
      <li><a href="#prompt">System Prompt Structure</a></li>
      <li><a href="#runtime">Runtime Architecture</a></li>
      <li><a href="#multi-bubble">Multi-Bubble Replies: Simulating Real Chat Rhythm</a></li>
      <li><a href="#rag">RAG Analysis: Worth the Complexity?</a></li>
      <li><a href="#review">Review System: Closed-Loop Feedback</a></li>
      <li><a href="#boundaries">Safety Boundaries</a></li>
      <li><a href="#conclusion">Conclusion</a></li>
    </ol>
  </nav>

  <!-- Article Body -->
  <article class="article-body">

    <!-- 1 -->
    <h2 id="idea" class="rv zh">æ ¸å¿ƒç†å¿µï¼š<em>æ•°æ®é©±åŠ¨</em>çš„ Persona</h2>
    <h2 class="rv en">Core Philosophy: <em>Data-Driven</em> Persona</h2>

    <p class="rv zh">å¸‚é¢ä¸Šçš„ persona chatbot å¤§å¤šé æ‰‹å†™ promptï¼š"ä½ æ˜¯ä¸€ä¸ªå‹å–„çš„åŠ©æ‰‹ï¼Œè¯´è¯é£æ ¼æ´»æ³¼â€¦"ã€‚è¿™ç§æ–¹å¼æœ‰ä¸€ä¸ªæœ¬è´¨é—®é¢˜â€”â€”<strong>ä½ æ€ä¹ˆå®šä¹‰"æ´»æ³¼"ï¼Ÿ</strong></p>
    <p class="rv en">Most persona chatbots rely on handwritten prompts: "You are a friendly assistant with a lively style..." This approach has a fundamental problem â€” <strong>how do you define "lively"?</strong></p>

    <p class="rv zh">Aime çš„åšæ³•ä¸ä¸€æ ·ã€‚å®ƒä¸æè¿°é£æ ¼ï¼Œå®ƒ<strong>æµ‹é‡</strong>é£æ ¼ï¼š</p>
    <p class="rv en">Aime takes a different approach. It doesn't describe style â€” it <strong>measures</strong> it:</p>

    <div class="diagram rv"><span class="dim zh">ä¼ ç»Ÿè·¯çº¿</span><span class="dim en">Traditional approach</span>
äººå·¥æè¿°æ€§æ ¼ â†’ æ‰‹å†™ prompt â†’ ç¥ˆç¥· AI ç†è§£

<span class="dim">Aime</span>
å¾®ä¿¡èŠå¤©è®°å½• â†’ <span class="hl">ç»Ÿè®¡åˆ†æ 7 ä¸ªç»´åº¦</span> â†’ é‡åŒ–æ•°å­—ç¼–ç è¿› prompt
                     â†“
               <span class="hl">æŒ‘é€‰ 20 æ¡ä»£è¡¨æ€§å¯¹è¯</span> â†’ few-shot examples</div>

    <p class="rv zh">å…·ä½“æ¥è¯´ï¼šä¸è¯´"ä½ è¯´è¯å¾ˆçŸ­"ï¼Œè€Œæ˜¯è¯´"ä½ çš„æ¶ˆæ¯å¹³å‡ 14.2 ä¸ªå­—ï¼Œ44.4% åœ¨ 10 å­—ä»¥å†…"ã€‚ä¸è¯´"ä½ å¶å°”ç”¨ emoji"ï¼Œè€Œæ˜¯è¯´"18.2% çš„æ¶ˆæ¯åŒ…å« emojiï¼Œæœ€å¸¸ç”¨çš„æ˜¯ ğŸ˜‚ğŸ˜­ğŸ¤®ğŸ™„ğŸ˜"ã€‚</p>
    <p class="rv en">Specifically: instead of saying "you write short messages", we say "your messages average 14.2 characters, 44.4% under 10 characters". Instead of "you occasionally use emoji", we say "18.2% of messages contain emoji, most used: ğŸ˜‚ğŸ˜­ğŸ¤®ğŸ™„ğŸ˜".</p>

    <div class="callout rv">
      <b class="zh">å…³é”®æ´å¯Ÿï¼š</b><b class="en">Key Insight:</b>
      <span class="zh">LLM å¯¹æ•°å­—çš„éµä»åº¦è¿œé«˜äºå½¢å®¹è¯ã€‚"å¹³å‡ 14 ä¸ªå­—"æ¯”"ç®€çŸ­"ç²¾ç¡® 10 å€ï¼ŒAI ä¹Ÿæ›´å®¹æ˜“æ‰§è¡Œã€‚</span>
      <span class="en">LLMs follow numbers far more precisely than adjectives. "Average 14 characters" is 10x more precise than "brief", and much easier for AI to execute.</span>
    </div>

    <hr class="section-divider">

    <!-- 2 -->
    <h2 id="pipeline" class="rv zh">è®­ç»ƒ Pipelineï¼šä»å¾®ä¿¡åˆ° <em>Prompt</em></h2>
    <h2 class="rv en">Training Pipeline: From WeChat to <em>Prompt</em></h2>

    <p class="rv zh">æ•´ä¸ªæµç¨‹ä¸æ¶‰åŠä»»ä½•æ¨¡å‹è®­ç»ƒã€‚äº”ä¸ªè„šæœ¬ï¼Œè·‘ä¸€éå°±å¥½ã€‚</p>
    <p class="rv en">The entire process involves zero model training. Five scripts, one run.</p>

    <div class="diagram rv"><span class="hl">Step 1</span>  å¾®ä¿¡ HTML å¯¼å‡º  â”€â”€â†’  parse_wechat.py  â”€â”€â†’  chat_pairs.jsonl
<span class="hl">Step 2</span>  chat_pairs.jsonl  â”€â”€â†’  analyze_style.py â”€â”€â†’  style_analysis.json
<span class="hl">Step 3</span>  chat_pairs.jsonl  â”€â”€â†’  build_vectordb.py â”€â”€â†’ vectors.npz <span class="dim">(RAG ç”¨)</span>
<span class="hl">Step 4</span>  style + QA é—®å·   â”€â”€â†’  prompt_builder.py â”€â”€â†’ system prompt
<span class="hl">Step 5</span>  system prompt      â”€â”€â†’  chat_engine.py    â”€â”€â†’ éƒ¨ç½²ä¸Šçº¿</div>

    <h3 class="rv zh">Step 1ï¼šè§£æå¾®ä¿¡è®°å½•</h3>
    <h3 class="rv en">Step 1: Parsing WeChat History</h3>

    <p class="rv zh">å¾®ä¿¡èŠå¤©è®°å½•é€šè¿‡ WeChatExporter å¯¼å‡ºä¸º HTMLã€‚è§£æé¢ä¸´å‡ ä¸ªæŒ‘æˆ˜ï¼š</p>
    <p class="rv en">WeChat history is exported as HTML via WeChatExporter. Parsing faces several challenges:</p>

    <ul class="rv zh">
      <li><strong>åˆ†é¡µåŠ è½½</strong>ï¼šé¦–é¡µçº¦ 1000 æ¡æ¶ˆæ¯ï¼Œå‰©ä½™åœ¨ JS æ–‡ä»¶ä¸­ï¼ˆ<code>msg-1.js</code>, <code>msg-2.js</code>â€¦ï¼‰</li>
      <li><strong>Emoji æ ‡ç­¾</strong>ï¼šå¾®ä¿¡ emoji æ˜¯ <code>&lt;img class="wxemoji"&gt;</code> æ ‡ç­¾ï¼Œéœ€è¦è½¬æˆ Unicode</li>
      <li><strong>è¿ç»­æ¶ˆæ¯åˆå¹¶</strong>ï¼šåŒä¸€ä¸ªäºº 2 åˆ†é’Ÿå†…çš„å¤šæ¡æ¶ˆæ¯åˆå¹¶ä¸ºä¸€æ¡ï¼ˆæ¨¡æ‹Ÿå¾®ä¿¡å¤šè¡Œå‘é€ï¼‰</li>
      <li><strong>ä¸Šä¸‹æ–‡å¯¹</strong>ï¼šæå– (context, response) å¯¹â€”â€”æ¯æ¡å›å¤é…æœ€å¤š 5 æ¡å‰æ–‡</li>
    </ul>
    <ul class="rv en">
      <li><strong>Paginated loading</strong>: First page has ~1000 messages, the rest are in JS files (<code>msg-1.js</code>, <code>msg-2.js</code>...)</li>
      <li><strong>Emoji tags</strong>: WeChat emojis are <code>&lt;img class="wxemoji"&gt;</code> tags that need conversion to Unicode</li>
      <li><strong>Consecutive message merging</strong>: Multiple messages from the same person within 2 minutes are merged into one (simulating WeChat multi-line sending)</li>
      <li><strong>Context pairs</strong>: Extract (context, response) pairs â€” each reply gets up to 5 preceding messages</li>
    </ul>

    <h3 class="rv zh">Step 2ï¼šç»Ÿè®¡é£æ ¼åˆ†æ</h3>
    <h3 class="rv en">Step 2: Statistical Style Analysis</h3>

    <p class="rv zh">è¿™æ˜¯æ•´ä¸ªç³»ç»Ÿçš„çµé­‚ã€‚ä¸‹ä¸€èŠ‚è¯¦ç»†å±•å¼€ã€‚</p>
    <p class="rv en">This is the soul of the entire system. Detailed in the next section.</p>

    <h3 class="rv zh">Step 3ï¼šæ„å»ºå‘é‡åº“ï¼ˆå¯é€‰ï¼‰</h3>
    <h3 class="rv en">Step 3: Building Vector Database (Optional)</h3>

    <p class="rv zh">ç”¨ Gemini Embedding API æŠŠæ‰€æœ‰å¯¹è¯å¯¹è½¬æˆ 768 ç»´å‘é‡ï¼Œå­˜ä¸º <code>.npz</code> æ–‡ä»¶ã€‚è¿è¡Œæ—¶åšä½™å¼¦ç›¸ä¼¼åº¦æ£€ç´¢ã€‚Python ç‰ˆæœ¬ç”¨åˆ°ï¼ŒWeb ç‰ˆæœ¬æ²¡ç”¨ã€‚</p>
    <p class="rv en">Use Gemini Embedding API to convert all conversation pairs into 768-dim vectors, stored as <code>.npz</code> files. Cosine similarity search at runtime. Used in Python version, not in Web version.</p>

    <hr class="section-divider">

    <!-- 3 -->
    <h2 id="style" class="rv zh">ç»Ÿè®¡åˆ†æï¼š<em>é‡åŒ–</em>ä¸€ä¸ªäººçš„èŠå¤©é£æ ¼</h2>
    <h2 class="rv en">Statistical Analysis: <em>Quantifying</em> Chat Style</h2>

    <p class="rv zh">ä» 8394 æ¡çœŸå®æ¶ˆæ¯ä¸­æå– 7 ä¸ªç»´åº¦çš„ç»Ÿè®¡æ•°æ®ï¼š</p>
    <p class="rv en">Extracted 7 dimensions of statistical data from 8,394 real messages:</p>

    <div class="stats-row rv">
      <div class="stat-card">
        <div class="stat-val">14.2</div>
        <div class="stat-label">Avg Length</div>
      </div>
      <div class="stat-card">
        <div class="stat-val">97%</div>
        <div class="stat-label">No Punctuation</div>
      </div>
      <div class="stat-card">
        <div class="stat-val">18.2%</div>
        <div class="stat-label">Emoji Usage</div>
      </div>
      <div class="stat-card">
        <div class="stat-val">29.3%</div>
        <div class="stat-label">Mixed Language</div>
      </div>
    </div>

    <table class="article-table rv zh">
      <thead>
        <tr><th>ç»´åº¦</th><th>åˆ†æå†…å®¹</th><th>å®é™…æ•°æ®</th></tr>
      </thead>
      <tbody>
        <tr><td>æ¶ˆæ¯é•¿åº¦</td><td>å¹³å‡å­—æ•°ã€çŸ­/ä¸­/é•¿å æ¯”</td><td>å¹³å‡ 14.2 å­—ï¼Œ44.4% &lt; 10 å­—</td></tr>
        <tr><td>æ ‡ç‚¹ä¹ æƒ¯</td><td>å„æ ‡ç‚¹å‡ºç°ç‡ã€æ— æ ‡ç‚¹ç‡</td><td>97% ä¸åŠ æ ‡ç‚¹</td></tr>
        <tr><td>å£å¤´ç¦…</td><td>Top 15 é«˜é¢‘è¯åŠå‡ºç°æ¬¡æ•°</td><td>å“ˆå“ˆ(342)ã€å—¯(128)ã€kk...</td></tr>
        <tr><td>Emoji</td><td>ä½¿ç”¨ç‡ã€Top 10 å¾®ä¿¡/Unicode emoji</td><td>18.2% å« emojiï¼Œæœ€çˆ± ğŸ˜‚ğŸ˜­ğŸ¤®</td></tr>
        <tr><td>æ¢è¡Œå€¾å‘</td><td>å¤šè¡Œæ¶ˆæ¯å æ¯”</td><td>ç»å¸¸æ‹†æˆå¤šæ¡çŸ­æ¶ˆæ¯å‘é€</td></tr>
        <tr><td>ä¸­è‹±æ··æ‚</td><td>çº¯ä¸­/çº¯è‹±/æ··æ‚æ¯”ä¾‹</td><td>29.3% æ··æ‚ä¸­è‹±æ–‡</td></tr>
        <tr><td>é£æ ¼æ€»ç»“</td><td>AI ç”Ÿæˆçš„æ•´ä½“æè¿°</td><td>åçŸ­å¥å‹ã€éšæ„ã€ä¸æ‹˜å°èŠ‚</td></tr>
      </tbody>
    </table>
    <table class="article-table rv en">
      <thead>
        <tr><th>Dimension</th><th>Analysis Content</th><th>Actual Data</th></tr>
      </thead>
      <tbody>
        <tr><td>Message length</td><td>Avg word count, short/mid/long ratio</td><td>Avg 14.2 chars, 44.4% &lt; 10 chars</td></tr>
        <tr><td>Punctuation</td><td>Punctuation frequency, no-punctuation rate</td><td>97% no punctuation</td></tr>
        <tr><td>Catchphrases</td><td>Top 15 frequent words with counts</td><td>å“ˆå“ˆ(342), å—¯(128), kk...</td></tr>
        <tr><td>Emoji</td><td>Usage rate, Top 10 WeChat/Unicode emoji</td><td>18.2% contain emoji, favorites: ğŸ˜‚ğŸ˜­ğŸ¤®</td></tr>
        <tr><td>Line breaks</td><td>Multi-line message ratio</td><td>Frequently splits into multiple short messages</td></tr>
        <tr><td>Mixed language</td><td>Pure CN / pure EN / mixed ratio</td><td>29.3% mixed Chinese-English</td></tr>
        <tr><td>Style summary</td><td>AI-generated overall description</td><td>Short sentences, casual, laid-back</td></tr>
      </tbody>
    </table>

    <p class="rv zh">è¿™äº›æ•°å­—ç›´æ¥ç¼–ç è¿› system promptã€‚AI çœ‹åˆ°"å¹³å‡ 14.2 å­—"å°±çŸ¥é“ä¸è¯¥è¾“å‡ºé•¿æ®µè½ï¼Œçœ‹åˆ°"97% æ— æ ‡ç‚¹"å°±è‡ªç„¶çœç•¥å¥å·ã€‚</p>
    <p class="rv en">These numbers are encoded directly into the system prompt. When AI sees "average 14.2 characters", it knows not to output long paragraphs. When it sees "97% no punctuation", it naturally omits periods.</p>

    <h3 class="rv zh">ä»£è¡¨æ€§å¯¹è¯æŒ‘é€‰</h3>
    <h3 class="rv en">Selecting Representative Examples</h3>

    <p class="rv zh">ä»å‡ åƒæ¡å¯¹è¯ä¸­æŒ‘å‡º 20 æ¡ä½œä¸º few-shot examplesï¼Œç­–ç•¥æ˜¯ä¸‰åˆ†æ³•ï¼š</p>
    <p class="rv en">From thousands of conversations, 20 are selected as few-shot examples using a three-way split strategy:</p>

    <div class="insight-grid zh">
      <div class="insight-card rv">
        <h4>1/3 å£å¤´ç¦…å¯¹è¯</h4>
        <p>åŒ…å«é«˜é¢‘è¯ï¼ˆå“ˆå“ˆã€å—¯ã€kkï¼‰çš„æ¶ˆæ¯ï¼Œå±•ç¤ºæœ€å…¸å‹çš„è¯´è¯ä¹ æƒ¯ã€‚</p>
      </div>
      <div class="insight-card rv">
        <h4>1/3 é•¿åº¦å‡è¡¡</h4>
        <p>çŸ­/ä¸­/é•¿æ¶ˆæ¯å„å–ä¸€äº›ï¼Œè®© AI çŸ¥é“ä¸åŒåœºæ™¯è¯¥å›å¤šå°‘å­—ã€‚</p>
      </div>
      <div class="insight-card rv">
        <h4>1/3 éšæœºé‡‡æ ·</h4>
        <p>å¡«è¡¥å‰©ä½™åé¢ï¼Œå¢åŠ å¤šæ ·æ€§ï¼Œé¿å… examples å¤ªåå‘æŸç§è¯é¢˜ã€‚</p>
      </div>
      <div class="insight-card rv">
        <h4>æ ¼å¼åŒ–è¾“å‡º</h4>
        <p>æ¯æ¡ example å¸¦ä¸Šä¸‹æ–‡ï¼Œæ ¼å¼ï¼š<code>æœ‹å‹(å°å±è›‹å„¿): xxx â†’ ä½ : xxx</code>ï¼Œè®© AI ç†è§£å¯¹è¯èŠ‚å¥ã€‚</p>
      </div>
    </div>
    <div class="insight-grid en">
      <div class="insight-card rv">
        <h4>1/3 Catchphrase Conversations</h4>
        <p>Messages containing frequent words (haha, hmm, kk), showcasing the most typical speaking habits.</p>
      </div>
      <div class="insight-card rv">
        <h4>1/3 Length-Balanced</h4>
        <p>A mix of short/mid/long messages, so AI knows how much to write in different scenarios.</p>
      </div>
      <div class="insight-card rv">
        <h4>1/3 Random Sampling</h4>
        <p>Fills remaining slots for diversity, preventing examples from skewing toward one topic.</p>
      </div>
      <div class="insight-card rv">
        <h4>Formatted Output</h4>
        <p>Each example includes context, formatted as: <code>Friend(nickname): xxx â†’ You: xxx</code>, helping AI understand conversation rhythm.</p>
      </div>
    </div>

    <hr class="section-divider">

    <!-- 4 -->
    <h2 id="prompt" class="rv zh">System Prompt çš„<em>ç»“æ„</em></h2>
    <h2 class="rv en">System Prompt <em>Structure</em></h2>

    <p class="rv zh">æœ€ç»ˆçš„ system prompt çº¦ 4000 å­—ï¼Œç”± 6 ä¸ªæ¨¡å—ç»„æˆï¼š</p>
    <p class="rv en">The final system prompt is ~4000 characters, composed of 6 modules:</p>

    <div class="diagram rv zh"><span class="hl">[èº«ä»½è®¾å®š]</span>    ä½ æ˜¯æŸ´å®ï¼Œä¸æ˜¯ AI åŠ©æ‰‹ï¼Œä½ å°±æ˜¯æŸ´å®æœ¬äººåœ¨å¾®ä¿¡èŠå¤©
<span class="hl">[ä¸ªäººä¿¡æ¯]</span>    å¹´é¾„ï¼ˆåŠ¨æ€è®¡ç®—ï¼‰ã€èŒä¸šã€æ‰€åœ¨åœ°ã€å®¶åº­ã€å…´è¶£
<span class="hl">[æ€§æ ¼ç‰¹å¾]</span>    å¹½é»˜ã€è‡ªå˜²ã€æœ‰ä¸»è§ã€å–œæ¬¢ç»„å±€ã€å¤§æ–¹
<span class="hl">[è¯´è¯é£æ ¼]</span>    ç»Ÿè®¡æ•°æ®ï¼šé•¿åº¦ã€æ ‡ç‚¹ã€å£å¤´ç¦…ã€emojiã€ä¸­è‹±æ··æ‚
<span class="hl">[å¯¹è¯ç¤ºä¾‹]</span>    20 æ¡ä»£è¡¨æ€§å¯¹è¯ï¼ˆå¸¦ä¸Šä¸‹æ–‡ï¼‰
<span class="hl">[å®‰å…¨è¾¹ç•Œ]</span>    éšç§ä¿æŠ¤ã€å…¬å¸ä¿¡æ¯ã€æ³•å¾‹åˆè§„</div>
    <div class="diagram rv en"><span class="hl">[Identity]</span>     You are Chai Ning, not an AI assistant â€” you ARE Ning chatting on WeChat
<span class="hl">[Personal Info]</span> Age (dynamically calculated), job, location, family, interests
<span class="hl">[Personality]</span>   Humorous, self-deprecating, opinionated, social organizer, generous
<span class="hl">[Speech Style]</span>  Stats: length, punctuation, catchphrases, emoji, CN-EN mixing
<span class="hl">[Examples]</span>      20 representative conversations (with context)
<span class="hl">[Safety]</span>        Privacy protection, company info, legal compliance</div>

    <h3 class="rv zh">åŠ¨æ€æ—¶é—´æ³¨å…¥</h3>
    <h3 class="rv en">Dynamic Time Injection</h3>

    <p class="rv zh">System prompt <strong>æ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°ç”Ÿæˆ</strong>ï¼Œæ³¨å…¥å½“å‰æ—¶é—´å’Œè®¡ç®—åçš„å¹´é¾„ï¼š</p>
    <p class="rv en">System prompt is <strong>regenerated for every request</strong>, injecting current time and calculated age:</p>

    <div class="code-block rv"><span class="cm">// æ¯æ¬¡ API è°ƒç”¨éƒ½é‡æ–°è®¡ç®—</span>
<span class="kw">const</span> now = <span class="kw">new</span> Date()
<span class="kw">const</span> year = now.toLocaleDateString(<span class="str">"zh-CN"</span>, {
  timeZone: <span class="str">"America/Los_Angeles"</span>,
  year: <span class="str">"numeric"</span>
})
<span class="kw">const</span> age = Number(year) - <span class="num">1994</span>

<span class="cm">// æ³¨å…¥ prompt</span>
<span class="str">`ã€å½“å‰çœŸå®æ—¶é—´ï¼š${dateStr} ${timeStr} å¤ªå¹³æ´‹æ—¶é—´ã€‚ã€‘`</span></div>

    <p class="rv zh">è¿™æ · AI æ°¸è¿œä¸ä¼šè¯´é”™è‡ªå·±çš„å¹´é¾„æˆ–æé”™å½“å‰æ—¶é—´ã€‚</p>
    <p class="rv en">This way, the AI never states the wrong age or mistakes the current time.</p>

    <h3 class="rv zh">åŒæ¨¡å¼è®¾è®¡</h3>
    <h3 class="rv en">Dual Mode Design</h3>

    <div class="insight-grid zh">
      <div class="insight-card rv">
        <h4>é—²èŠæ¨¡å¼ï¼ˆé»˜è®¤ï¼‰</h4>
        <p>çŸ­æ¶ˆæ¯ã€å£è¯­åŒ–ã€å¸¦å£å¤´ç¦…ã€‚5-20 å­—ä¸€æ¡ï¼Œå¯èƒ½æ‹†æˆ 2-3 æ¡å‘é€ã€‚</p>
      </div>
      <div class="insight-card rv">
        <h4>çŸ¥è¯†æ¨¡å¼</h4>
        <p>è§¦å‘æ¡ä»¶ï¼šæŠ€æœ¯é—®é¢˜ã€ä¸“ä¸šè¯é¢˜ã€‚å…è®¸æ›´é•¿å›å¤ï¼Œä½†ä¿æŒä¸ªäººè¯­æ°”ã€‚</p>
      </div>
    </div>
    <div class="insight-grid en">
      <div class="insight-card rv">
        <h4>Casual Mode (Default)</h4>
        <p>Short messages, colloquial, with filler words. 5-20 chars per message, may split into 2-3 messages.</p>
      </div>
      <div class="insight-card rv">
        <h4>Knowledge Mode</h4>
        <p>Triggered by: technical questions, professional topics. Allows longer replies but maintains personal voice.</p>
      </div>
    </div>

    <hr class="section-divider">

    <!-- 5 -->
    <h2 id="runtime" class="rv zh">è¿è¡Œæ—¶<em>æ¶æ„</em></h2>
    <h2 class="rv en">Runtime <em>Architecture</em></h2>

    <p class="rv zh">ä»ç”¨æˆ·å‘é€æ¶ˆæ¯åˆ°æ”¶åˆ°å›å¤ï¼Œç»å†ä»¥ä¸‹æµç¨‹ï¼š</p>
    <p class="rv en">From user sending a message to receiving a reply, the following pipeline executes:</p>

    <div class="diagram rv zh"><span class="hl">ç”¨æˆ·è¾“å…¥</span> â†’ React å‰ç«¯
       â†“
<span class="hl">/api/chat</span> â†’ Vercel Function
       â†“
  1. åŠ¨æ€ç”Ÿæˆ system promptï¼ˆå«å½“å‰æ—¶é—´/å¹´é¾„ï¼‰
  2. æ ¼å¼åŒ–æœ€è¿‘ 20 æ¡å†å²æ¶ˆæ¯
  3. å¦‚æœ‰æ›´æ—©æ¶ˆæ¯ï¼Œæ³¨å…¥ç³»ç»Ÿæç¤ºï¼š"ä¹‹å‰è¿˜æœ‰ N æ¡æ¶ˆæ¯"
       â†“
<span class="hl">Gemini 2.0 Flash</span> â†’ maxOutputTokens: 128, temperature: 0.8
       â†“
  4. æ‹†åˆ†å¤šè¡Œå›å¤ï¼ˆæŒ‰æ¢è¡Œç¬¦ï¼‰
  5. è¿‡æ»¤ [Emoji] å ä½ç¬¦
  6. é™åˆ¶æœ€å¤š 3 æ¡æ¶ˆæ¯
       â†“
<span class="hl">å‰ç«¯æ˜¾ç¤º</span> â†’ æ¯æ¡æ¶ˆæ¯åŠ  typing delay
       â†“
<span class="hl">Redis</span> â†’ å¼‚æ­¥ä¿å­˜ï¼ˆä¸é˜»å¡å“åº”ï¼‰ï¼Œ90 å¤© TTL</div>
    <div class="diagram rv en"><span class="hl">User input</span> â†’ React frontend
       â†“
<span class="hl">/api/chat</span> â†’ Vercel Function
       â†“
  1. Dynamically generate system prompt (with current time/age)
  2. Format last 20 history messages
  3. If older messages exist, inject system note: "N earlier messages"
       â†“
<span class="hl">Gemini 2.0 Flash</span> â†’ maxOutputTokens: 128, temperature: 0.8
       â†“
  4. Split multi-line reply (by newline)
  5. Filter [Emoji] placeholders
  6. Cap at 3 messages max
       â†“
<span class="hl">Frontend display</span> â†’ typing delay per message
       â†“
<span class="hl">Redis</span> â†’ async save (non-blocking), 90-day TTL</div>

    <h3 class="rv zh">å…³é”®å‚æ•°</h3>
    <h3 class="rv en">Key Parameters</h3>

    <table class="article-table rv zh">
      <thead>
        <tr><th>å‚æ•°</th><th>å€¼</th><th>åŸå› </th></tr>
      </thead>
      <tbody>
        <tr><td>maxOutputTokens</td><td>128</td><td>å¼ºåˆ¶çŸ­å›å¤ï¼Œæ¨¡æ‹Ÿå¾®ä¿¡æ¶ˆæ¯é•¿åº¦</td></tr>
        <tr><td>temperature</td><td>0.8</td><td>è‡ªç„¶ä½†ä¸è·‘åâ€”â€”é—²èŠéœ€è¦éšæœºæ€§</td></tr>
        <tr><td>ä¸Šä¸‹æ–‡çª—å£</td><td>20 æ¡</td><td>å¹³è¡¡è¿è´¯æ€§ä¸ token æˆæœ¬</td></tr>
        <tr><td>æœ€å¤§å›å¤æ¡æ•°</td><td>3</td><td>æ¨¡æ‹Ÿå¾®ä¿¡å¤šæ¡æ¶ˆæ¯ï¼Œä½†ä¸è¿‡åº¦</td></tr>
        <tr><td>Redis TTL</td><td>90 å¤©</td><td>å¤Ÿç”¨äº reviewï¼Œä¸ä¼šæ— é™è†¨èƒ€</td></tr>
      </tbody>
    </table>
    <table class="article-table rv en">
      <thead>
        <tr><th>Parameter</th><th>Value</th><th>Reason</th></tr>
      </thead>
      <tbody>
        <tr><td>maxOutputTokens</td><td>128</td><td>Force short replies, simulating WeChat message length</td></tr>
        <tr><td>temperature</td><td>0.8</td><td>Natural but not off-the-rails â€” casual chat needs randomness</td></tr>
        <tr><td>Context window</td><td>20 messages</td><td>Balance coherence with token cost</td></tr>
        <tr><td>Max reply count</td><td>3</td><td>Simulate WeChat multi-message, but don't overdo it</td></tr>
        <tr><td>Redis TTL</td><td>90 days</td><td>Enough for review, won't grow indefinitely</td></tr>
      </tbody>
    </table>

    <hr class="section-divider">

    <!-- 6 -->
    <h2 id="multi-bubble" class="rv zh">å¤šæ¶ˆæ¯å›å¤ï¼šæ¨¡æ‹ŸçœŸå®<em>èŠå¤©èŠ‚å¥</em></h2>
    <h2 class="rv en">Multi-Bubble Replies: Simulating Real <em>Chat Rhythm</em></h2>

    <p class="rv zh">çœŸäººåœ¨å¾®ä¿¡èŠå¤©ä¸ä¼šä¸€æ¬¡å‘ä¸€å¤§æ®µã€‚ä¼šæ‹†æˆ 2-3 æ¡çŸ­æ¶ˆæ¯ï¼Œä¸­é—´æœ‰è‡ªç„¶çš„æ‰“å­—é—´éš”ã€‚Aime å®Œæ•´æ¨¡æ‹Ÿäº†è¿™ä¸ªè¡Œä¸ºã€‚</p>
    <p class="rv en">Real people don't send one big paragraph on WeChat. They split into 2-3 short messages with natural typing intervals. Aime fully simulates this behavior.</p>

    <h3 class="rv zh">åç«¯ï¼šæ‹†åˆ†å›å¤</h3>
    <h3 class="rv en">Backend: Splitting Replies</h3>

    <div class="code-block rv"><span class="cm">// Gemini è¾“å‡ºæŒ‰æ¢è¡Œç¬¦æ‹†åˆ†</span>
<span class="kw">const</span> replies = raw
  .<span class="fn">split</span>(<span class="str">"\n"</span>)
  .<span class="fn">map</span>(line => line.trim())
  .<span class="fn">filter</span>(line => line.length > <span class="num">0</span>)
  .<span class="fn">slice</span>(<span class="num">0</span>, <span class="num">3</span>)

<span class="cm">// è‡³å°‘è¿”å›ä¸€æ¡æ¶ˆæ¯</span>
<span class="kw">const</span> finalReplies = replies.length > <span class="num">0</span> ? replies : [<span class="str">"å—¯"</span>]</div>

    <h3 class="rv zh">å‰ç«¯ï¼šæ¨¡æ‹Ÿæ‰“å­—å»¶è¿Ÿ</h3>
    <h3 class="rv en">Frontend: Simulating Typing Delay</h3>

    <div class="code-block rv"><span class="cm">// æ¯æ¡æ¶ˆæ¯çš„å»¶è¿Ÿä¸é•¿åº¦æˆæ­£æ¯”</span>
<span class="kw">for</span> (<span class="kw">let</span> i = <span class="num">0</span>; i < replies.length; i++) {
  <span class="kw">const</span> delay = Math.<span class="fn">min</span>(<span class="num">400</span> + replies[i].length * <span class="num">80</span>, <span class="num">2500</span>)
  <span class="kw">await new</span> Promise(r => <span class="fn">setTimeout</span>(r, delay))
  <span class="fn">addMessage</span>(replies[i])
}

<span class="cm">// "å“ˆå“ˆ" (2å­—) â†’ 560ms delay</span>
<span class="cm">// "æˆ‘è§‰å¾—è¿™ä¸ªæ–¹æ¡ˆå¯ä»¥" (8å­—) â†’ 1040ms delay</span>
<span class="cm">// ä¸€å¤§æ®µè¯ â†’ æœ€å¤š 2500ms</span></div>

    <p class="rv zh">åŠ ä¸Šå‰ç«¯çš„ typing indicatorï¼ˆä¸‰ä¸ªè·³åŠ¨çš„ç‚¹ï¼‰ï¼Œæ•´ä¸ªä½“éªŒéå¸¸æ¥è¿‘çœŸäººå‘æ¶ˆæ¯ã€‚</p>
    <p class="rv en">Combined with the frontend's typing indicator (three bouncing dots), the entire experience closely mimics a real person sending messages.</p>

    <hr class="section-divider">

    <!-- 7 -->
    <h2 id="rag" class="rv zh">RAG åˆ†æï¼š<em>å€¼ä¸å€¼å¾—</em>ç”¨ï¼Ÿ</h2>
    <h2 class="rv en">RAG Analysis: <em>Is It Worth</em> the Complexity?</h2>

    <p class="rv zh">Python ç‰ˆæœ¬åŒ…å«å®Œæ•´çš„ RAG pipelineâ€”â€”å‘é‡åŒ– 5000+ æ¡å†å²å¯¹è¯ï¼Œè¿è¡Œæ—¶æ£€ç´¢æœ€ç›¸ä¼¼çš„ 5 æ¡ä½œä¸ºå‚è€ƒã€‚ä½† Web ç‰ˆæœ¬æ²¡æœ‰ç”¨ã€‚ä¸ºä»€ä¹ˆï¼Ÿ</p>
    <p class="rv en">The Python version includes a complete RAG pipeline â€” vectorizing 5000+ historical conversations, retrieving the 5 most similar ones as reference at runtime. But the Web version doesn't use it. Why?</p>

    <div class="insight-grid zh">
      <div class="insight-card rv">
        <h4>RAG æœ‰å¸®åŠ©çš„åœºæ™¯</h4>
        <p><strong>å°ä¼—è¯é¢˜ã€‚</strong> æ¯”å¦‚ç”¨æˆ·é—®åˆ°ç‰¹å®šçš„å…±åŒå›å¿†ã€å°ä¼—æ¢—æˆ–ç½•è§å£å¤´ç¦…ï¼Œé™æ€ prompt è¦†ç›–ä¸åˆ°ï¼ŒRAG èƒ½ä»å†å²ä¸­æ£€ç´¢åˆ°ç›¸å…³å¯¹è¯ã€‚</p>
      </div>
      <div class="insight-card rv">
        <h4>RAG è¿‡åº¦å·¥ç¨‹çš„åœºæ™¯</h4>
        <p><strong>æ—¥å¸¸é—²èŠã€‚</strong> ç»Ÿè®¡é£æ ¼è§„åˆ™å·²ç»èƒ½å¤„ç† 90% çš„å¸¸è§å¯¹è¯ã€‚RAG å¢åŠ  ~100ms å»¶è¿Ÿå’ŒåŸºç¡€è®¾æ–½å¤æ‚åº¦ï¼Œæ”¶ç›Šæœ‰é™ã€‚</p>
      </div>
    </div>
    <div class="insight-grid en">
      <div class="insight-card rv">
        <h4>Where RAG Helps</h4>
        <p><strong>Niche topics.</strong> When users ask about specific shared memories, obscure inside jokes, or rare catchphrases, static prompts can't cover them â€” RAG can retrieve relevant conversations from history.</p>
      </div>
      <div class="insight-card rv">
        <h4>Where RAG Is Over-Engineering</h4>
        <p><strong>Daily chat.</strong> Statistical style rules already handle 90% of common conversations. RAG adds ~100ms latency and infrastructure complexity for limited gain.</p>
      </div>
    </div>

    <div class="callout rv">
      <b class="zh">ç»“è®ºï¼š</b><b class="en">Conclusion:</b>
      <span class="zh">å¯¹äº persona chatbotï¼ŒPrompt-only æ–¹æ¡ˆç›®å‰æ›´ä¼˜ã€‚å•æ¬¡ API è°ƒç”¨ ~800msï¼Œé›¶é¢å¤–åŸºç¡€è®¾æ–½ï¼Œæ”¹ä¸€ä¸ªæ–‡ä»¶å°±èƒ½è¿­ä»£ã€‚RAG ç•™ä½œåå¤‡â€”â€”ç­‰åˆ°éœ€è¦"äº‹å®å›å¿†"èƒ½åŠ›æ—¶å†å¯ç”¨ã€‚</span>
      <span class="en">For persona chatbots, the Prompt-only approach currently wins. Single API call ~800ms, zero additional infrastructure, iterate by editing one file. RAG is kept as a backup â€” enable when "factual recall" capability is needed.</span>
    </div>

    <hr class="section-divider">

    <!-- 8 -->
    <h2 id="review" class="rv zh">Review ç³»ç»Ÿï¼š<em>é—­ç¯</em>åé¦ˆ</h2>
    <h2 class="rv en">Review System: <em>Closed-Loop</em> Feedback</h2>

    <p class="rv zh">Prompt å·¥ç¨‹ä¸æ˜¯ä¸€æ¬¡æ€§çš„ã€‚éœ€è¦æŒç»­è§‚å¯Ÿæ•ˆæœï¼Œå‘ç°é—®é¢˜ï¼Œè¿­ä»£æ”¹è¿›ã€‚Aime å†…ç½®äº†ä¸€ä¸ª <a href="https://aime.ning.codes/review.html" target="_blank">Review é¡µé¢</a> æ¥å®Œæˆè¿™ä¸ªé—­ç¯ã€‚</p>
    <p class="rv en">Prompt engineering isn't a one-time thing. You need to continuously observe effects, discover issues, and iterate improvements. Aime has a built-in <a href="https://aime.ning.codes/review.html" target="_blank">Review page</a> to close this loop.</p>

    <h3 class="rv zh">æ•°æ®é‡‡é›†</h3>
    <h3 class="rv en">Data Collection</h3>

    <p class="rv zh">æ¯æ¬¡å¯¹è¯äº¤äº’è‡ªåŠ¨ä¿å­˜åˆ° Redisâ€”â€”ç”¨æˆ·æ¶ˆæ¯ã€AI å›å¤ã€ä¸Šä¸‹æ–‡å†å²ã€session IDã€‚ä¸é˜»å¡å“åº”ï¼Œfire-and-forget æ¨¡å¼ã€‚</p>
    <p class="rv en">Every conversation interaction is automatically saved to Redis â€” user messages, AI replies, context history, session ID. Non-blocking, fire-and-forget.</p>

    <h3 class="rv zh">Review åŠŸèƒ½</h3>
    <h3 class="rv en">Review Features</h3>

    <div class="insight-grid zh">
      <div class="insight-card rv">
        <h4>åŒè§†å›¾æ¨¡å¼</h4>
        <p><strong>Session View</strong>ï¼šæŒ‰ä¼šè¯åˆ†ç»„ï¼Œçœ‹å®Œæ•´å¯¹è¯æµã€‚<strong>Flat View</strong>ï¼šé€æ¡æŸ¥çœ‹ï¼Œé€‚åˆå¿«é€Ÿæ‰«æã€‚</p>
      </div>
      <div class="insight-card rv">
        <h4>è¯„åˆ†ç³»ç»Ÿ</h4>
        <p>æ¯æ¡äº¤äº’å¯æ ‡è®°ä¸º Good / Badã€‚ç”¨äºè¿½è¸ª prompt è°ƒæ•´å‰åçš„è´¨é‡å˜åŒ–ã€‚</p>
      </div>
      <div class="insight-card rv">
        <h4>è¿‡æ»¤å™¨</h4>
        <p>All / Unrated / Good / Bad å››ç§è¿‡æ»¤ï¼Œå¸¦å®æ—¶è®¡æ•°ã€‚å¿«é€Ÿå®šä½é—®é¢˜å›å¤ã€‚</p>
      </div>
      <div class="insight-card rv">
        <h4>JSON å¯¼å‡º</h4>
        <p>ä¸€é”®å¯¼å‡ºæ‰€æœ‰å¯¹è¯æ•°æ®ã€‚å¯ä»¥ç”¨æ¥åšè¿›ä¸€æ­¥åˆ†æï¼Œæˆ–ä½œä¸º fine-tuning è®­ç»ƒé›†ã€‚</p>
      </div>
    </div>
    <div class="insight-grid en">
      <div class="insight-card rv">
        <h4>Dual View Mode</h4>
        <p><strong>Session View</strong>: Grouped by session, see full conversation flow. <strong>Flat View</strong>: One-by-one, ideal for quick scanning.</p>
      </div>
      <div class="insight-card rv">
        <h4>Rating System</h4>
        <p>Each interaction can be marked Good / Bad. Used to track quality changes before and after prompt adjustments.</p>
      </div>
      <div class="insight-card rv">
        <h4>Filters</h4>
        <p>All / Unrated / Good / Bad with real-time counts. Quickly locate problematic replies.</p>
      </div>
      <div class="insight-card rv">
        <h4>JSON Export</h4>
        <p>One-click export of all conversation data. Can be used for further analysis or as a fine-tuning training set.</p>
      </div>
    </div>

    <h3 class="rv zh">è¿­ä»£å¾ªç¯</h3>
    <h3 class="rv en">Iteration Cycle</h3>

    <div class="diagram rv zh">1. éƒ¨ç½²æ–° prompt â†’ ç”¨æˆ·èŠå¤©
2. Review é¡µé¢æŸ¥çœ‹å¯¹è¯è´¨é‡
3. å‘ç°é—®é¢˜ï¼ˆå¤ªé•¿/å¤ªç”Ÿç¡¬/é£æ ¼åç¦»ï¼‰
4. è°ƒæ•´ promptï¼ˆæ”¹è§„åˆ™/æ¢ examples/è°ƒå‚æ•°ï¼‰
5. é‡æ–°éƒ¨ç½² â†’ å›åˆ°æ­¥éª¤ 1

<span class="dim">æ¯è½®è¿­ä»£åªéœ€è¦æ”¹ä¸€ä¸ªæ–‡ä»¶ï¼Œéƒ¨ç½²ä¸€æ¬¡ vercel --prod</span></div>
    <div class="diagram rv en">1. Deploy new prompt â†’ users chat
2. Review page: inspect conversation quality
3. Spot issues (too long / too stiff / style drift)
4. Adjust prompt (change rules / swap examples / tune params)
5. Redeploy â†’ back to step 1

<span class="dim">Each iteration: edit one file, deploy once with vercel --prod</span></div>

    <hr class="section-divider">

    <!-- 9 -->
    <h2 id="boundaries" class="rv zh">å®‰å…¨<em>è¾¹ç•Œ</em></h2>
    <h2 class="rv en">Safety <em>Boundaries</em></h2>

    <p class="rv zh">Persona chatbot æœ‰ä¸€ä¸ªç‹¬ç‰¹é£é™©ï¼šå®ƒåœ¨æ‰®æ¼”ä¸€ä¸ª<strong>çœŸäºº</strong>ã€‚å¦‚æœ AI ç¼–é€ äº†ä¸å­˜åœ¨çš„ä¸ªäººä¿¡æ¯ï¼Œæˆ–è€…æ³„éœ²äº†æ•æ„Ÿæ•°æ®ï¼Œåæœæ¯”æ™®é€š chatbot ä¸¥é‡å¾—å¤šã€‚</p>
    <p class="rv en">Persona chatbots have a unique risk: they're impersonating a <strong>real person</strong>. If the AI fabricates non-existent personal information or leaks sensitive data, the consequences are far more serious than with a regular chatbot.</p>

    <p class="rv zh">System prompt ä¸­æœ‰ä¸€ä¸ªæ˜ç¡®çš„"æœ€é‡è¦"è§„åˆ™åŒºï¼š</p>
    <p class="rv en">The system prompt has an explicit "most important" rules section:</p>

    <div class="code-block rv"><span class="cm">// System prompt å®‰å…¨è¾¹ç•Œï¼ˆèŠ‚é€‰ï¼‰</span>

<span class="kw">ã€ç»å¯¹ä¸èƒ½åšçš„äº‹æƒ…ã€‘</span>
- ä¸æ³„éœ²éšç§ï¼šæ‰‹æœºå·ã€åœ°å€ã€èº«ä»½è¯ã€å¯†ç ã€é“¶è¡Œå¡ã€å·¥å·
- ä¸è¯´å…¬å¸æœºå¯†ï¼šTikTok çš„æ¶æ„ã€æ¨¡å‹ã€å†…éƒ¨å·¥å…·
- ä¸å¸®åŠ©è¿æ³•è¡Œä¸ºï¼šé’“é±¼é‚®ä»¶ã€è¯ˆéª—ã€é»‘å®¢æ”»å‡»
- å·²å©šï¼Œä¸è°ƒæƒ…ï¼Œä¸ç©æš§æ˜§
- ä¸é¼“åŠ±è‡ªæ®‹è‡ªæ€ï¼Œé‡åˆ°è¦å»ºè®®æ‰¾ä¸“ä¸šå¸®åŠ©
- <span class="str">ä¸ç¼–é€ ä¸ªäººä¿¡æ¯â€”â€”åªè¯´ä¸Šé¢æä¾›çš„åŸºæœ¬ä¿¡æ¯</span></div>

    <div class="callout rv">
      <b class="zh">è®¾è®¡åŸåˆ™ï¼š</b><b class="en">Design Principle:</b>
      <span class="zh">ç™½åå• > é»‘åå•ã€‚ä¸æ˜¯"ä¸è¦è¯´ X"ï¼Œè€Œæ˜¯"åªèƒ½è¯´è¿™äº›"ã€‚AI åªäº†è§£ prompt ä¸­æä¾›çš„ä¸ªäººä¿¡æ¯ï¼Œè¶…å‡ºèŒƒå›´çš„ä¸€å¾‹ç”¨å¹½é»˜åŒ–è§£ï¼š<code>"è¿™ä¸ªæˆ‘ä¸å¤ªæ–¹ä¾¿è¯´å“ˆ"</code>ã€‚</span>
      <span class="en">Whitelist > Blacklist. Not "don't say X", but "you can only say these things". The AI only knows personal information provided in the prompt. Anything beyond that is deflected with humor: <code>"I'd rather not say haha"</code>.</span>
    </div>

    <hr class="section-divider">

    <!-- 10 -->
    <h2 id="conclusion" class="rv zh"><em>æ€»ç»“</em></h2>
    <h2 class="rv en"><em>Conclusion</em></h2>

    <p class="rv zh">Aime çš„æ ¸å¿ƒå…¬å¼ï¼š</p>
    <p class="rv en">Aime's core formula:</p>

    <div class="diagram rv"><span class="hl">çœŸå®çš„ Persona</span> = ç»Ÿè®¡é‡åŒ–çš„è¯´è¯é£æ ¼
                 + ç²¾é€‰çš„å¯¹è¯ Examples
                 + ä¸¥æ ¼çš„å®‰å…¨è¾¹ç•Œ
                 + æŒç»­çš„ Review è¿­ä»£</div>

    <p class="rv zh">ä¸éœ€è¦å¾®è°ƒã€‚ä¸éœ€è¦è®­ç»ƒæ•°æ®ã€‚ä¸éœ€è¦ GPUã€‚</p>
    <p class="rv en">No fine-tuning needed. No training data. No GPU.</p>

    <p class="rv zh">ä¸€ä¸ª BeautifulSoup è§£æè„šæœ¬ã€ä¸€ä¸ªç»Ÿè®¡åˆ†æè„šæœ¬ã€ä¸€ä¸ªå¥½çš„ system promptã€‚ä¸‰ä¸ªç»„ä»¶å°±èƒ½è®© AI å­¦ä¼šä¸€ä¸ªçœŸäººçš„èŠå¤©é£æ ¼â€”â€”ç²¾ç¡®åˆ°æ¯æ¡æ¶ˆæ¯çš„å¹³å‡å­—æ•°å’Œ emoji ä½¿ç”¨é¢‘ç‡ã€‚</p>
    <p class="rv en">A BeautifulSoup parsing script, a statistical analysis script, a well-crafted system prompt. Three components are all it takes to teach AI a real person's chat style â€” precise down to average character count and emoji usage frequency.</p>

    <p class="rv zh">å¦‚æœä½ ä¹Ÿæƒ³åšä¸€ä¸ª persona chatbotï¼Œä¸è¦ä»æ¨¡å‹å¾®è°ƒå¼€å§‹ã€‚ä»æ•°æ®å¼€å§‹ã€‚å…ˆé‡åŒ–ä½ çš„è¯´è¯ä¹ æƒ¯ï¼Œå†è®© AI æ‰§è¡Œè¿™äº›æ•°å­—ã€‚</p>
    <p class="rv en">If you also want to build a persona chatbot, don't start with model fine-tuning. Start with data. First quantify your speaking habits, then let AI execute those numbers.</p>

    <div class="callout rv">
      <b>Try it:</b> <a href="https://aime.ning.codes" target="_blank">aime.ning.codes</a> Â· <a href="https://aime.ning.codes/showcase.html" target="_blank">Technical Showcase</a>
    </div>

  </article>

  <footer class="page-footer">
    <span>&copy; 2025 Ning</span>
    <span class="made"><span class="heart"></span> vibed into existence</span>
  </footer>
</div>

<script>
const obs = new IntersectionObserver((entries) => {
  entries.forEach(e => {
    if (e.isIntersecting) {
      e.target.classList.add('v');
      obs.unobserve(e.target);
    }
  });
}, { threshold: 0.08 });

document.querySelectorAll('.rv').forEach(el => obs.observe(el));

// Language toggle
const langToggle = document.getElementById('langToggle');
langToggle.addEventListener('click', () => {
  document.documentElement.classList.toggle('lang-en');
  langToggle.textContent = document.documentElement.classList.contains('lang-en') ? 'ä¸­æ–‡' : 'EN';
});
</script>

</body>
</html>
